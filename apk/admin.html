<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin ‚Ä¢ Produtos</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0b1b29;
  color:#fff;
  padding:20px;
}
h1{
  text-align:center;
  color:#1de9b6;
}
.card{
  background:#1e1e1e;
  padding:16px;
  margin-top:15px;
  border-radius:12px;
}
input,select,button{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:none;
  margin-top:8px;
}
button{
  background:#1de9b6;
  font-weight:bold;
  cursor:pointer;
}
img{
  width:80px;
  border-radius:8px;
  margin-top:10px;
}
</style>
</head>

<body>

<h1>üõç Cadastro de Produtos</h1>

<div class="card">
  <input id="nome" placeholder="Nome do Produto">
  <input id="preco" type="number" placeholder="Pre√ßo">
  
  <select id="categoria">
    <option>Servi√ßos</option>
    <option>Eletr√¥nicos</option>
  </select>

  <!-- FOTO DO CELULAR -->
  <input type="file" id="foto" accept="image/*" capture="environment">

  <button onclick="salvarProduto()">Salvar Produto</button>
</div>

<h2>Produtos Cadastrados</h2>
<div id="lista"></div>

<script type="module">

import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "SUA_PUBLIC_KEY_AQUI"
);

/* üîê PROTEGER ADMIN */
async function proteger(){
  const { data } = await supabase.auth.getUser();
  if(!data.user){
    window.location.href="login-admin.html";
  }
}
proteger();

/* üì∏ SALVAR PRODUTO */
window.salvarProduto = async () => {

  const nome = document.getElementById("nome").value;
  const preco = document.getElementById("preco").value;
  const categoria = document.getElementById("categoria").value;
  const file = document.getElementById("foto").files[0];

  if(!nome || !preco || !file){
    alert("Preencha todos os campos!");
    return;
  }

  // üî• Upload da imagem
  const nomeArquivo = Date.now()+"-"+file.name;

  const { error: erroUpload } = await supabase.storage
    .from("produtos")
    .upload(nomeArquivo, file);

  if(erroUpload){
    alert("Erro no upload");
    return;
  }

  const { data } = supabase.storage
    .from("produtos")
    .getPublicUrl(nomeArquivo);

  const urlImagem = data.publicUrl;

  // üî• Salvar no banco
  await supabase.from("produtos").insert({
    nome: nome,
    preco: preco,
    categoria: categoria,
    imagem: urlImagem
  });

  alert("Produto cadastrado!");
  listar();
};

/* üìã LISTAR PRODUTOS */
async function listar(){

  const { data } = await supabase
    .from("produtos")
    .select("*")
    .order("created_at", { ascending:false });

  const lista = document.getElementById("lista");
  lista.innerHTML="";

  data.forEach(p=>{
    lista.innerHTML += `
      <div class="card">
        <strong>${p.nome}</strong><br>
        R$ ${p.preco}<br>
        ${p.categoria}<br>
        <img src="${p.imagem}">
      </div>
    `;
  });
}

listar();

</script>

</body>
</html>
