<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Catálogo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:system-ui,Arial;
  background:#020617;
  color:#fff;
}

.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:12px;
  padding:12px;
}

.card{
  background:#0f172a;
  border-radius:12px;
  overflow:hidden;
}

/* IMAGEM GRANDE */
.card img{
  width:100%;
  height:170px;
  object-fit:cover;
  cursor:pointer;
}

/* BOLINHAS */
.dots{
  display:flex;
  justify-content:center;
  gap:6px;
  padding:6px 0;
}
.dot{
  width:7px;
  height:7px;
  border-radius:50%;
  background:#475569;
}
.dot.active{
  background:#22c55e;
}

.info{
  padding:8px;
  text-align:center;
}
.info h4{
  margin:4px 0;
  font-size:14px;
}
.preco{
  color:#22c55e;
  font-weight:700;
}
</style>
</head>

<body>

<div class="grid" id="grid"></div>

<script>
/* ✅ APP (MULTINEGÓCIO) */
const APP_ATUAL = "60787bf4-f226-49f3-9bed-e9a961fc5542";

const supabaseClient = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

const fotos = {};
const indice = {};

async function carregar(){
  const { data, error } = await supabaseClient
    .from("produtos")
    .select("*")
    .eq("app", APP_ATUAL)   // ✅ FILTRO CORRETO
    .order("nome");

  if(error){
    alert(error.message);
    console.log(error);
    return;
  }

  grid.innerHTML = "";

  data.forEach(p => {
    let imgs = [];

    if(p.imagem){
      try{
        imgs = p.imagem.startsWith("[")
          ? JSON.parse(p.imagem)
          : [p.imagem];
      }catch{
        imgs = [];
      }
    }

    if(!imgs.length){
      imgs = ["https://via.placeholder.com/400x300?text=Sem+Foto"];
    }

    fotos[p.id] = imgs;
    indice[p.id] = 0;

    const dotsHTML = imgs.map((_,i)=>`
      <span class="dot ${i===0?'active':''}"
            id="dot-${p.id}-${i}"></span>
    `).join("");

    grid.innerHTML += `
      <div class="card">
        <img id="img-${p.id}"
             src="${imgs[0]}"
             onclick="trocar('${p.id}')">

        <div class="dots">
          ${dotsHTML}
        </div>

        <div class="info">
          <h4>${p.nome}</h4>
          <div class="preco">
            R$ ${Number(p.preco).toFixed(2)}
          </div>
        </div>
      </div>
    `;
  });
}

function trocar(id){
  if(fotos[id].length <= 1) return;

  indice[id] = (indice[id] + 1) % fotos[id].length;

  document.getElementById(`img-${id}`).src =
    fotos[id][indice[id]];

  fotos[id].forEach((_,i)=>{
    document.getElementById(`dot-${id}-${i}`)
      .classList.toggle("active", i === indice[id]);
  });
}

carregar();
</script>

</body>
</html>
