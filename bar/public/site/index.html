<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Site Institucional</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<link rel="stylesheet" href="../assets/css/site.css">

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#020617;
  color:#fff;
}
header{
  padding:24px;
  text-align:center;
  background:#0f172a;
}
header h1{margin:0}
header p{opacity:.7}

.banner{
  margin:20px auto;
  max-width:1000px;
}
.banner img{
  width:100%;
  border-radius:18px;
}

.section{
  max-width:1000px;
  margin:40px auto;
  padding:0 16px;
}
.section h2{
  margin-bottom:16px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
}

.card{
  background:#0f172a;
  padding:16px;
  border-radius:16px;
}
.card img{
  width:100%;
  border-radius:12px;
}
.card h3{
  margin:10px 0 6px;
}
.card p{
  font-size:14px;
  opacity:.7;
}

footer{
  margin-top:60px;
  padding:24px;
  text-align:center;
  background:#0f172a;
  opacity:.8;
}
footer a{
  color:#22c55e;
  text-decoration:none;
  font-weight:bold;
}
</style>
</head>

<body>

<header>
  <h1 id="nome">Nome do Estabelecimento</h1>
  <p id="descricao">Descri√ß√£o do estabelecimento</p>
</header>

<div id="banners"></div>

<div class="section">
  <h2>‚ú® Destaques</h2>
  <div class="grid" id="produtos"></div>
</div>

<footer>
  <p id="endereco"></p>
  <p>
    <a id="whatsapp" target="_blank">Falar no WhatsApp</a>
  </p>
</footer>

<script>
const sb = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

// pega app_id da URL
const params = new URLSearchParams(window.location.search);
const app_id = params.get("app");

if(!app_id){
  document.body.innerHTML = "<h2 style='text-align:center'>App inv√°lido</h2>";
  throw new Error("app_id ausente");
}

// üîπ CONFIG DO SITE
async function carregarConfig(){
  const { data } = await sb
    .from("site_config")
    .select("*")
    .eq("app_id", app_id)
    .single();

  if(!data) return;

  nome.innerText = data.nome || "";
  descricao.innerText = data.descricao || "";
  endereco.innerText = data.endereco || "";

  if(data.whatsapp){
    whatsapp.href = `https://wa.me/55${data.whatsapp}`;
  }
}

// üîπ BANNERS
async function carregarBanners(){
  const { data } = await sb
    .from("banners_site")
    .select("*")
    .eq("app_id", app_id)
    .order("id", { ascending:false });

  banners.innerHTML = data.map(b => `
    <div class="banner">
      <img src="${b.imagem}" alt="${b.titulo}">
    </div>
  `).join("");
}

// üîπ PRODUTOS VITRINE
async function carregarProdutos(){
  const { data } = await sb
    .from("produtos_site")
    .select("*")
    .eq("app_id", app_id)
    .order("id", { ascending:false });

  produtos.innerHTML = data.map(p => `
    <div class="card">
      <img src="${p.imagem}">
      <h3>${p.nome}</h3>
      <p>${p.descricao}</p>
    </div>
  `).join("");
}

const nome = document.getElementById("nome");
const descricao = document.getElementById("descricao");
const endereco = document.getElementById("endereco");
const whatsapp = document.getElementById("whatsapp");
const banners = document.getElementById("banners");
const produtos = document.getElementById("produtos");

carregarConfig();
carregarBanners();
carregarProdutos();
</script>

</body>
</html>
