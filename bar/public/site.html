<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>FF Soluções</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#020617;
  --card:#0f172a;
  --primary:#38bdf8;
  --text:#e5e7eb;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:Inter,system-ui,Arial;
}

body{
  background:var(--bg);
  color:var(--text);
}

header{
  padding:28px;
  text-align:center;
  border-bottom:1px solid #1e293b;
}

header h1{
  font-size:28px;
  color:var(--primary);
}

header p{
  opacity:.8;
  margin-top:6px;
}

.banner{
  max-width:1100px;
  margin:30px auto;
  border-radius:20px;
  overflow:hidden;
  background:#000;
}

.banner img{
  width:100%;
  height:380px;
  object-fit:cover;
}

.dots{
  display:flex;
  justify-content:center;
  gap:8px;
  margin-top:12px;
}

.dot{
  width:10px;
  height:10px;
  border-radius:50%;
  background:#334155;
}
.dot.active{
  background:var(--primary);
}

.section{
  max-width:1100px;
  margin:60px auto;
  padding:0 24px;
  text-align:center;
}

footer{
  margin-top:80px;
  padding:24px;
  text-align:center;
  opacity:.6;
  font-size:14px;
}
</style>
</head>

<body>

<header>
  <h1 id="nome">Carregando...</h1>
  <p id="descricao"></p>
</header>

<div class="banner">
  <img id="bannerImg" src="">
</div>

<div class="dots" id="dots"></div>

<section class="section">
  <h2>Sobre nós</h2>
  <p id="sobre"></p>
</section>

<footer>
  © FF Soluções • Tecnologia para negócios
</footer>

<script>
/* ========= APP ========= */
const params = new URLSearchParams(location.search);
const appId = params.get("app");

if(!appId){
  document.body.innerHTML = "<h2 style='padding:40px'>Negócio não identificado</h2>";
  throw new Error("APP não informado");
}

/* ========= SUPABASE ========= */
const supabase = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

/*
  Estrutura esperada no banco:

  tabela: negocios
  - id
  - nome
  - descricao
  - sobre

  tabela: banners
  - id
  - app_id
  - imagem_url
*/

/* ========= BUSCAR DADOS ========= */
async function carregarSite(){
  const { data: negocio } = await supabase
    .from("negocios")
    .select("*")
    .eq("id", appId)
    .single();

  if(!negocio){
    document.body.innerHTML = "<h2 style='padding:40px'>Negócio não encontrado</h2>";
    return;
  }

  document.getElementById("nome").innerText = negocio.nome;
  document.getElementById("descricao").innerText = negocio.descricao || "";
  document.getElementById("sobre").innerText = negocio.sobre || "";

  const { data: banners } = await supabase
    .from("banners")
    .select("imagem_url")
    .eq("app_id", appId)
    .order("id");

  if(!banners || banners.length === 0){
    document.querySelector(".banner").style.display = "none";
    return;
  }

  let index = 0;
  const img = document.getElementById("bannerImg");
  const dots = document.getElementById("dots");

  img.src = banners[0].imagem_url;

  banners.forEach((_, i) => {
    const d = document.createElement("div");
    d.className = "dot" + (i === 0 ? " active" : "");
    d.onclick = () => {
      index = i;
      atualizar();
    };
    dots.appendChild(d);
  });

  setInterval(() => {
    index = (index + 1) % banners.length;
    atualizar();
  }, 5000);

  function atualizar(){
    img.src = banners[index].imagem_url;
    document.querySelectorAll(".dot").forEach((d,i)=>{
      d.classList.toggle("active", i === index);
    });
  }
}

carregarSite();
</script>

</body>
</html>
