<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Mesa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;font-family:Arial;background:#020617;color:#fff}
.topo{background:#0f172a;padding:16px;font-size:20px}
.container{max-width:900px;margin:auto;padding:20px}
button{padding:10px;border-radius:10px;border:none;cursor:pointer}
</style>
</head>

<body>

<div class="topo" id="tituloMesa">üçΩÔ∏è Mesa</div>

<div class="container">
  <div id="pedido"></div>
</div>

<script>
const sb = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

const params = new URLSearchParams(location.search);
const mesaId = params.get("mesa");
const appId  = params.get("app_id");

if(!mesaId || !appId){
  alert("Acesso inv√°lido");
  location.href="mesas.html";
}

async function carregarMesa(){
  const { data } = await sb
    .from("mesas")
    .select("numero_mesa")
    .eq("id",mesaId)
    .single();

  tituloMesa.innerText = `üçΩÔ∏è Mesa ${data.numero_mesa}`;
}

async function carregarPedidos(){
  const { data } = await sb
    .from("pedido_itens")
    .select("*")
    .eq("app_id", appId)
    .in("pedido_id",
      sb.from("pedidos")
        .select("id")
        .eq("mesa_id", mesaId)
    );

  pedido.innerHTML = "";
  (data||[]).forEach(i=>{
    pedido.innerHTML += `<p>${i.nome_produto} x ${i.quantidade}</p>`;
  });
}

(async()=>{
  await carregarMesa();
  await carregarPedidos();
})();
</script>

</body>
</html>
