<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Teste Pagamento</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#020617;
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.box{
  background:#0f172a;
  padding:24px;
  border-radius:16px;
  width:100%;
  max-width:400px;
  text-align:center;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  background:#22c55e;
  font-weight:bold;
  cursor:pointer;
  margin-top:16px;
}
</style>
</head>

<body>

<div class="box">
  <h2>ðŸ”§ Teste de Update</h2>
  <p>Clique para testar UPDATE em <b>pedidos</b></p>
  <button onclick="confirmarPagamento()">TESTAR UPDATE</button>
</div>

<script>
const sb = supabase.createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

const params = new URLSearchParams(location.search);
const pedidoId = params.get("pedido");

if(!pedidoId){
  alert("Informe ?pedido=ID_NA_URL");
}

async function confirmarPagamento(){
  alert("Clique recebido");

  const { error } = await sb
    .from("pedidos")
    .update({ status: "finalizado" })
    .eq("id", pedidoId);

  if(error){
    console.error("ERRO SUPABASE REAL:", error);
    alert(
      "ERRO REAL:\n" +
      (error.message || "") + "\n" +
      (error.details || "")
    );
    return;
  }

  alert("âœ… UPDATE FUNCIONOU");
}
</script>

</body>
</html>
