<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>FF SOLUÇÕES | Acompanhar Serviço</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
  body {
    font-family:'Segoe UI', Arial, sans-serif;
    background:#0b1b29;
    color:#cbd5e1;
    margin:0;
    min-height:100vh;
  }
  /* TOPO */
  .topo {
    background: linear-gradient(90deg,#0b3d1a,#2f8f4e);
    padding:15px 20px;
    display:flex; align-items:center; gap:12px;
    border-bottom:3px solid #4b1fa0;
    color:#fff; font-weight:700; font-size:22px;
    box-shadow:0 3px 8px rgba(0,0,0,0.2);
    position:sticky; top:0; z-index:1000;
  }
  .topo span { font-size:18px; font-weight:500; color:#b7f3d8; }

  /* SEÇÃO */
  .section-card {
    background: linear-gradient(135deg,#2f8f4e,#4b1fa0);
    margin:20px auto; padding:20px; border-radius:16px;
    max-width:400px; box-shadow:0 4px 12px rgba(0,0,0,0.3);
  }
  .section-card h2 { text-align:center; margin-bottom:15px; color:#fff; }
  .section-card input, .section-card select, .section-card button {
    width:100%; padding:12px; margin:8px 0; border-radius:12px; border:none;
    font-size:14px; outline:none;
  }
  .section-card input, .section-card select { background:#0b1b29; color:#cbd5e1; border:1px solid #b7f3d8; }
  .section-card button { background:#fff; color:#2f8f4e; font-weight:bold; cursor:pointer; transition:0.3s; }
  .section-card button:hover { background:#b7f3d8; color:#0b1b29; }

  #resultado, #msgCadastro { margin-top:12px; font-weight:bold; color:#fff; }

  #listaClientes div {
    border:1px solid #fff; padding:8px; margin:4px 0; border-radius:8px; background: rgba(255,255,255,0.05);
  }
  #listaClientes button {
    margin-right:6px; padding:4px 8px; border:none; border-radius:6px;
    cursor:pointer; font-size:12px; font-weight:bold;
  }
  #listaClientes button.edit { background:#4b1fa0; color:#fff; }
  #listaClientes button.delete { background:#e74c3c; color:#fff; }

  /* RESPONSIVO */
  @media(max-width:480px){
    .topo { font-size:18px; gap:8px; }
    .section-card { margin:15px 10px; }
  }
</style>
</head>
<body>

<header class="topo">
  <i class="fas fa-wifi"></i>
  <span>FF SOLUÇÕES | Acompanhar Serviço</span>
</header>

<!-- CLIENTE -->
<div class="section-card">
  <h2><i class="fas fa-user"></i> Cliente</h2>
  <input type="text" id="codigo" placeholder="Digite seu código">
  <button id="btnVerificar">Verificar</button>
  <div id="resultado"></div>
</div>

<!-- ADMINISTRADOR -->
<div class="section-card" id="adminArea">
  <h2><i class="fas fa-user-shield"></i> Administrador</h2>
  <input type="password" id="adminSenha" placeholder="Senha de administrador">
  <button id="btnLogin">Entrar</button>

  <div id="cadastro" style="display:none; margin-top:10px;">
    <input type="text" id="codigoNovo" placeholder="Código do Cliente">
    <select id="statusNovo">
      <option value="">Selecione o Status</option>
      <option value="Pendente">Pendente</option>
      <option value="Em andamento">Em andamento</option>
      <option value="Concluído">Concluído</option>
      <option value="Aguardando retirada">Aguardando retirada</option>
    </select>
    <input type="text" id="obsNova" placeholder="Observação">
    <button id="btnCadastrar">Cadastrar / Atualizar</button>
    <div id="msgCadastro"></div>
    <div id="listaClientes" style="margin-top:15px;"></div>
  </div>
</div>

<!-- BOTÃO FLUTUANTE WHATSAPP -->
<a href="https://wa.me/5589981452698" target="_blank" 
   style="position:fixed; bottom:20px; right:20px; background:#25D366; color:white; border-radius:50%; width:60px; height:60px; display:flex; align-items:center; justify-content:center; font-size:30px; box-shadow:0 4px 8px rgba(0,0,0,0.2); z-index:999;">
   <i class="fab fa-whatsapp"></i>
</a>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBgar59yF1k6XmfG0iNOXvWCWKIa9dHcdI",
    authDomain: "servicospc-b3382.firebaseapp.com",
    projectId: "servicospc-b3382",
    storageBucket: "servicospc-b3382.firebasestorage.app",
    messagingSenderId: "35103134828",
    appId: "1:35103134828:web:a57b932f6bd698b8e3b449",
    measurementId: "G-FNFPRJW3HB"
  };

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// SENHA ADMIN
const senhaAdmin = "4676796345dfg";

// ELEMENTOS
const cadastro = document.getElementById('cadastro');

// ===== CLIENTE =====
document.getElementById('btnVerificar').addEventListener('click', async ()=>{
  const codigo = document.getElementById('codigo').value.trim();
  const resultado = document.getElementById('resultado');
  if(!codigo){ resultado.innerText='Digite um código.'; return; }

  const docRef = doc(db,"servicos",codigo);
  const docSnap = await getDoc(docRef);
  if(docSnap.exists()){
    const data = docSnap.data();
    resultado.innerHTML = `
      <p>Status: <strong>${data.status}</strong></p>
      <p>Observação: ${data.observacao || 'Nenhuma'}</p>
      <p>Valor R$: ${data.observacao || 'Nenhuma'}</p>
    `;
  } else resultado.innerText='Código não encontrado.';
});

// ===== ADMIN =====
document.getElementById('btnLogin').addEventListener('click', ()=>{
  const senha = document.getElementById('adminSenha').value;
  if(senha === senhaAdmin){
    cadastro.style.display='block';
    carregarClientes();
  } else alert('Senha incorreta!');
});

// CADASTRAR / ATUALIZAR
document.getElementById('btnCadastrar').addEventListener('click', async ()=>{
  const codigo = document.getElementById('codigoNovo').value.trim();
  const status = document.getElementById('statusNovo').value;
  const observacao = document.getElementById('obsNova').value.trim();
  if(!codigo || !status){ alert('Código e Status obrigatórios'); return; }

  await setDoc(doc(db,"servicos",codigo), {status, observacao});
  document.getElementById('codigoNovo').value='';
  document.getElementById('statusNovo').value='';
  document.getElementById('obsNova').value='';
  carregarClientes();
});

// CARREGAR CLIENTES
async function carregarClientes(){
  const listaDiv = document.getElementById('listaClientes');
  listaDiv.innerHTML = '';
  const querySnapshot = await getDocs(collection(db,"servicos"));
  querySnapshot.forEach(docSnap=>{
    const data = docSnap.data();
    const div = document.createElement('div');
    div.innerHTML = `
      <strong>Código:</strong> ${docSnap.id}<br>
      <strong>Status:</strong> ${data.status}<br>
      <strong>Obs:</strong> ${data.observacao || 'Nenhuma'}<br>
      <button class="edit" onclick="editarCliente('${docSnap.id}','${data.status}','${data.observacao || ''}')">Editar</button>
      <button class="delete" onclick="excluirCliente('${docSnap.id}')">Excluir</button>
    `;
    listaDiv.appendChild(div);
  });
}

// FUNÇÕES EDITAR / EXCLUIR
window.editarCliente = function(codigo,status,obs){
  document.getElementById('codigoNovo').value=codigo;
  document.getElementById('statusNovo').value=status;
  document.getElementById('obsNova').value=obs;
}

window.excluirCliente = async function(codigo){
  if(confirm(`Deseja realmente excluir o cliente ${codigo}?`)){
    await deleteDoc(doc(db,"servicos",codigo));
    carregarClientes();
  }
}
</script>

</body>
</html>
