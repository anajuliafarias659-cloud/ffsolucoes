<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Super Admin | FF SoluÃ§Ãµes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#020617;color:#fff}
.container{max-width:1200px;margin:40px auto;padding:30px;border-radius:20px;background:linear-gradient(135deg,#0f172a,#4b1fa0)}
h1,h2,h3{margin-top:25px}
input,select,button{width:100%;padding:14px;margin-top:10px;border-radius:12px;border:none}
button{background:#22c55e;color:#000;font-weight:bold;cursor:pointer}
button.danger{background:#e53935;color:#fff}
.card{background:#020617;padding:16px;margin-top:12px;border-radius:14px;display:flex;justify-content:space-between;align-items:flex-start;gap:10px}
.login{max-width:420px;margin:80px auto}
hr{margin:40px 0;border:none;height:1px;background:rgba(255,255,255,.2)}
.badge{background:#334155;padding:4px 8px;border-radius:6px;font-size:12px}
.badge.warn{background:#7c2d12}
</style>
</head>

<body>
<div class="container">

<h1>ðŸ‘‘ Super Admin â€” FF SoluÃ§Ãµes</h1>

<div class="login" id="loginBox">
  <input id="usuarioSuper" placeholder="UsuÃ¡rio">
  <input id="senhaSuper" type="password" placeholder="Senha">
  <button onclick="login()">Entrar</button>
</div>

<div id="painel" style="display:none">

<h2>ðŸ“¦ Contas Demo</h2>
<div id="listaDemos"></div>

<hr>

<!-- RESTANTE DO SEU PAINEL CONTINUA NORMAL -->

</div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://pdajixsoowcyhnjwhgpc.supabase.co",
  "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
);

/* LOGIN */
window.login = async ()=>{
  const { data } = await supabase
    .from("super_admins")
    .select("*")
    .eq("usuario",usuarioSuper.value)
    .eq("senha",senhaSuper.value)
    .eq("ativo",true)
    .maybeSingle();

  if(!data) return alert("Login invÃ¡lido");

  loginBox.style.display="none";
  painel.style.display="block";

  carregarDemos();
};

/* =========================
   CARREGAR CONTAS DEMO
========================= */
async function carregarDemos(){

  const { data } = await supabase
    .from("apps")
    .select("*")
    .eq("plano","demo");

  listaDemos.innerHTML = "";

  (data || []).forEach(app=>{

    const hoje = new Date();
    const expira = new Date(app.data_expiracao);
    const vencida = expira < hoje;

    const status = vencida ? "VENCIDA" : "ATIVA";
    const cor = vencida ? "#7c2d12" : "#15803d";

    listaDemos.innerHTML += `
      <div class="card">
        <div>
          <b>${app.nome}</b><br>
          <small>Expira em: ${expira.toLocaleDateString()}</small><br>
          <span class="badge" style="background:${cor}">
            ${status}
          </span>
        </div>

        <div style="display:flex;gap:6px;flex-direction:column">

          <select id="dias_${app.id}">
            <option value="15">15 dias</option>
            <option value="30">30 dias</option>
            <option value="60">60 dias</option>
            <option value="90">90 dias</option>
          </select>

          <button onclick="renovarDemo('${app.id}')">
            ðŸ”„ Renovar
          </button>

        </div>
      </div>
    `;
  });
}

/* =========================
   RENOVAR CONTA DEMO
========================= */
window.renovarDemo = async (id)=>{

  const diasSelecionados = Number(
    document.getElementById(`dias_${id}`).value
  );

  const { data } = await supabase
    .from("apps")
    .select("data_expiracao")
    .eq("id",id)
    .single();

  let baseData = new Date();
  const hoje = new Date();

  if(data.data_expiracao){
    const atual = new Date(data.data_expiracao);
    if(atual > hoje){
      baseData = atual;
    }
  }

  baseData.setDate(baseData.getDate() + diasSelecionados);

  await supabase
    .from("apps")
    .update({
      data_expiracao: baseData,
      ativo: true
    })
    .eq("id",id);

  alert(`Renovado por ${diasSelecionados} dias!`);
  carregarDemos();
};
</script>

</body>
</html>
