<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Locadora</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* ===== VARI√ÅVEIS BASE ===== */
:root{
  --primaria:#e30613;
  --bg:#f4f4f4;
  --card:#ffffff;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Segoe UI',system-ui,sans-serif;
}

body{
  background:var(--bg);
  color:#111;
}

/* ===== BANNER ===== */
.banner-wrapper{padding:20px}
.banner{
  width:100%;
  height:45vh;
  max-height:320px;
  background:#000 center/cover no-repeat;
  border-radius:22px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

@media(max-width:768px){
  .banner{
    height:auto;
    aspect-ratio:16/9;
    background-size:contain;
  }
}

/* ===== LISTA ===== */
.lista{
  max-width:1200px;
  margin:20px auto 30px;
  padding:16px;
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
  gap:20px;
}

.card{
  background:var(--card);
  border-radius:18px;
  overflow:hidden;
  box-shadow:0 10px 25px rgba(0,0,0,.12);
  display:flex;
  flex-direction:column;
}

.card img{
  width:100%;
  height:180px;
  object-fit:contain;
  background:#f1f1f1;
}

.info{padding:14px;flex:1}
.preco{font-weight:700;margin:6px 0}
.status{font-weight:700}
.status.disponivel{color:#16a34a}
.status.alugado{color:#e30613}

.btn{
  margin:12px;
  background:var(--primaria);
  color:#fff;
  padding:12px;
  border-radius:12px;
  text-align:center;
  font-weight:700;
  cursor:pointer;
}

/* ================= TEMAS (CORRETOS) ================= */

/* üéÜ Ano Novo */
body.tema-ano-novo{
  --bg:#020617;
  --card:#020617;
  color:#fff;
}

/* üî• S√£o Jo√£o */
body.tema-sao-joao{
  --bg:#1b0f08;
  --card:#2a160d;
  color:#fff;
}
body.tema-sao-joao .btn{background:#f97316}

/* üé≠ Carnaval */
body.tema-carnaval{
  --bg:#12002f;
  --card:#1f005c;
  color:#fff;
}
body.tema-carnaval .btn{
  background:linear-gradient(45deg,#22c55e,#ec4899,#facc15);
}

/* üéÑ Natal */
body.tema-natal{
  --bg:#041b15;
  --card:#063f2e;
  color:#fff;
}
body.tema-natal .btn{background:#16a34a}
</style>
</head>

<body>

<div class="banner-wrapper">
  <div class="banner" id="banner"></div>
</div>

<section class="lista" id="listaVeiculos"></section>

<script>
const params = new URLSearchParams(location.search);
const appId = params.get("app_id");

if(!appId){
  document.body.innerHTML =
    "<h2 style='text-align:center;padding:40px'>Locadora n√£o identificada</h2>";
}else{
  iniciarApp(appId);
}

/* ===== TEMA ===== */
function aplicarTema(tema){
  document.body.className =
    document.body.className.replace(/tema-\S+/g,"").trim();

  if(tema && tema !== "padrao"){
    document.body.classList.add("tema-"+tema);
  }
}

function temaPorData(){
  const mes = new Date().getMonth() + 1;
  if(mes === 12) return "natal";
  if(mes === 6) return "sao-joao";
  if(mes === 2) return "carnaval";
  if(mes === 1) return "ano-novo";
  return null;
}

async function iniciarApp(APP_ID){
  const sb = supabase.createClient(
    "https://pdajixsoowcyhnjwhgpc.supabase.co",
    "sb_publishable_LatlFlcxk6IchHe3RNmfwA_9Oq4EsZw"
  );

  const { data } = await sb
    .from("config_site")
    .select("*")
    .eq("app_id", APP_ID)
    .single();

  if(data){
    document.title = data.nome_site || "Locadora";
    document.documentElement.style
      .setProperty("--primaria", data.cor_primaria || "#e30613");

    if(data.banner_url){
      banner.style.backgroundImage =
        `url('${data.banner_url}?v=${Date.now()}')`;
    }

    /* üî• AQUI EST√Å A CHAVE */
    const temaURL = params.get("tema");
    aplicarTema(temaURL || data.tema_site || temaPorData());
  }

  const { data: veiculos } = await sb
    .from("veiculos")
    .select("id,modelo,diaria,status,foto_url")
    .eq("app_id", APP_ID);

  listaVeiculos.innerHTML = "";

  veiculos?.forEach(v=>{
    listaVeiculos.innerHTML += `
      <div class="card">
        <img src="${v.foto_url || 'https://via.placeholder.com/400x200'}">
        <div class="info">
          <h3>${v.modelo}</h3>
          <div class="preco">R$ ${v.diaria} / di√°ria</div>
          <div class="status ${v.status}">
            ${v.status === 'alugado' ? 'üîí Alugado' : '‚úÖ Dispon√≠vel'}
          </div>
        </div>
        <div class="btn" onclick="location.href='./veiculo.html?app_id=${APP_ID}&id=${v.id}'">
          Alugar ve√≠culo
        </div>
      </div>
    `;
  });
}
</script>

</body>
</html>
